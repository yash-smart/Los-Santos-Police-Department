<!DOCTYPE html>
<html lang="en">

<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Los Santos Police Department</title>
    <link rel="stylesheet" href="/news-announcements-add.css">
</head>

<body>
    <% if (new_news) { %>
        <form action="/add-heading/<%= news_id %>/<%= user_id %>" method="post">
            <textarea name="heading" placeholder="Add Heading"></textarea>
            <input type="submit" value="Add">
        </form>
        <% } else { %>
            <% for (let i=0;i<newselements.length;i++) { %>
                <div style="margin: 10px;" id="<%= newselements[i].order_number %>" class="newselement">
                    <% if (newselements[i].type=='Heading' ) { %>
                        <h2>
                            <%= newselements[i].text %>
                        </h2>
                        <div style="display: none;" id="u<%= newselements[i].order_number %>">
                            <form
                                action="/update-heading/<%= news_id %>/<%= user_id %>/<%= newselements[i].order_number %>"
                                method="post">
                                <textarea name="heading" placeholder="Updated Heading" required></textarea>
                                <input type="submit" value="Update">
                            </form>
                            <a href="/news-update/<%= news_id %>/<%= user_id %>"><button>Cancel</button></a>
                        </div>
                        <% } else if (newselements[i].type=='text' ) {%>
                            <p style="white-space: pre-wrap;"><%= newselements[i].text.trim() %></p>
                            <div style="display: none;" id="u<%= newselements[i].order_number %>">
                                <form
                                    action="/update-text/<%= news_id %>/<%= user_id %>/<%= newselements[i].order_number %>"
                                    method="post">
                                    <textarea name="content" placeholder="Add Text"
                                        style="white-space: pre-wrap;" required></textarea>
                                    <input type="submit" name="Add">
                                </form>
                                <a href="/news-update/<%= news_id %>/<%= user_id %>"><button>Cancel</button></a>
                            </div>
                            <% } else if (newselements[i].type=='image' ) {%>
                                <img src="/images/<%= newselements[i].image_number %>"
                                    class="<%= newselements[i].type %>">
                                <p style="color: gray">
                                    <%= newselements[i].caption %>
                                </p>
                                <div style="display: none;" id="u<%= newselements[i].order_number %>">
                                    <form
                                        action="/update-image/<%= news_id %>/<%= user_id %>/<%= newselements[i].order_number %>"
                                        method="post" enctype="multipart/form-data">
                                        <input type="file" name="image" accept="image/*" required>
                                        <textarea name="caption" placeholder="Add Caption"></textarea>
                                        <input type="submit" name="Add">
                                    </form>
                                    <a href="/news-update/<%= news_id %>/<%= user_id %>"><button>Cancel</button></a>
                                </div>
                                <% } else if (newselements[i].type=='video' ){ %>
                                    <video width="500px" src="/images/<%= newselements[i].image_number %>" controls>
                                        <!-- <source src="/images" type="video/*"> -->
                                    </video>
                                    <p style="color: gray">
                                        <%= newselements[i].caption %>
                                    </p>
                                    <div style="display: none;" id="u<%= newselements[i].order_number %>">
                                        <form
                                            action="/update-video/<%= news_id %>/<%= user_id %>/<%= newselements[i].order_number %>"
                                            method="post" enctype="multipart/form-data">
                                            <input type="file" name="video" accept="video/*" required>
                                            <textarea name="caption" placeholder="Add Caption"></textarea>
                                            <input type="submit" name="Add">
                                        </form>
                                        <a href="/news-update/<%= news_id %>/<%= user_id %>"><button>Cancel</button></a>
                                    </div>
                                    <% } %>
                                    <div id="updatedelete<%= newselements[i].order_number %>">
                                        <a
                                            href="/delete/<%= news_id %>/<%= user_id %>/<%= newselements[i].order_number %>"><button>Delete</button></a>
                                        <button class="update"
                                            order_number="<%= newselements[i].order_number %>">Update</button>
                                    </div>
                </div>
                <% } %>
                    <div id="add">
                        <button id="add_text_button">Add Text</button>
                        <button id="add_image_button">Add Image</button>
                        <button id="add_video_button">Add Video</button>
                    </div>
                    <div id="add_text" style="display: none;">
                        <form action="/add-text/<%= news_id %>/<%= user_id %>" method="post">
                            <textarea name="content" placeholder="Add Text" style="white-space: pre-wrap;" required></textarea>
                            <input type="submit" name="Add">
                        </form>
                        <a href="/news-update/<%= news_id %>/<%= user_id %>"><button>Cancel</button></a>
                    </div>
                    <div id="add_image" style="display: none;">
                        <form action="/add-image/<%= news_id %>/<%= user_id %>" method="post"
                            enctype="multipart/form-data">
                            <input type="file" name="image" accept="image/*" required>
                            <textarea name="caption" placeholder="Add Caption"></textarea>
                            <input type="submit" name="Add">
                        </form>
                        <a href="/news-update/<%= news_id %>/<%= user_id %>"><button>Cancel</button></a>
                    </div>
                    <div id="add_video" style="display: none;">
                        <form action="/add-video/<%= news_id %>/<%= user_id %>" method="post"
                            enctype="multipart/form-data">
                            <input type="file" name="video" accept="video/*" required>
                            <textarea name="caption" placeholder="Add Caption"></textarea>
                            <input type="submit" name="Add">
                        </form>
                        <a href="/news-update/<%= news_id %>/<%= user_id %>"><button>Cancel</button></a>
                    </div>
                    
                    <% if (locals.posted_on) { %>
                        <p style="display: none;" id="posted_on_data"><%= posted_on %></p>
                        <p id="posted_on">Posted on: </p>
                    <% } %>
                    <section class="like_comments">
                        <p>Likes: <%= likes %></p>
                        <p>Comments: <%= comments_count %></p>
                        <% if (!liked) { %>
                            <a href="/like-admin/<%= news_id %>" style="margin: 10px;margin-bottom: 10px !important;"><button>Like</button></a>
                        <% } else { %>
                            <a href="/unlike-admin/<%= news_id %>" style="margin: 10px;margin-bottom: 10px !important;"><button>Unlike</button></a>
                        <% } %>
                        <form action="/comment-admin/<%= news_id %>" method="post">
                            <textarea name="comment" style="white-space: pre-wrap;margin-top: 20px;margin-bottom: 20px;"></textarea>
                            <input type="submit" value="Submit" >
                        </form>
                        <h3>Comments</h3>
                        <% for (let i=0;i<comments.length;i++) { %>
                            <div style="margin: 20px;">
                                <h4><%= users[i] %></h4>
                                <p><%= comments[i].text %></p>
                                <p id="p<%= i %>">Posted on: </p>
                                <p style="display: none;" class="posted_on" iterator="<%= i %>"><%= comments[i].posted_on %></p>
                            </div>
                        <% } %>
                    </section>
                    <% } %>
</body>
<script src="/news-announcement-add.js"></script>
<script>
    function getDateTime(date) {
        let day = date.getDate();
        let month = date.getMonth()+1;
        let year = date.getFullYear();
        let hours = date.getHours();
        let minutes = date.getMinutes();
        day = day<10?`0${day}`:day;
        month = month<10?`0${month}`:month;
        year = year<10?`0${year}`:year;
        hours = hours<10?`0${hours}`:hours;
        minutes = minutes<10?`0${minutes}`:minutes;
        return `${day}/${month}/${year} ${hours}:${minutes}`;
    }
    let posted_on = new Date(document.getElementById('posted_on_data').textContent);
    document.getElementById('posted_on').textContent+=getDateTime(posted_on);
</script>
</html>